<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Examen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link th:href="@{/css/app.css}" rel="stylesheet">
</head>
<body>
<header class="app-header">
    <div class="container-fluid">
        <div class="d-flex align-items-center justify-content-between py-2 px-3">
            <div class="d-flex align-items-center gap-3">
                <span class="app-header-logo">SE</span>
                <span class="app-header-title d-none d-md-inline">Simulador del Examen</span>
            </div>
            <div class="d-flex align-items-center gap-3">
                <div class="text-end d-none d-sm-block">
                    <div class="app-header-name" th:text="${userName} ?: 'Usuario'">Usuario</div>
                    <div class="app-header-email helper-text" th:text="${userEmail}">correo@ejemplo.com</div>
                </div>
                <img th:if="${userPicture}" th:src="${userPicture}" alt="Foto" class="app-header-avatar" referrerpolicy="no-referrer" loading="lazy"/>
                <a th:href="@{/agregar-examen}" class="btn btn-sm btn-outline-light">Agregar examen</a>
                <a th:if="${puedeCargarExcel}" th:href="@{/importar-preguntas}" class="btn btn-sm btn-outline-light">Importar preguntas</a>
                <a th:href="@{/logout}" class="btn btn-sm btn-outline-light">Cerrar sesión</a>
            </div>
        </div>
    </div>
</header>
<div class="container-fluid examen-wrapper d-flex flex-column align-items-center px-3 py-4">
    <div class="row w-100 justify-content-center" style="max-width: 1400px;">
        <div class="col-12">
            <div class="content-card p-4 p-md-5">
                <div th:if="${mensaje}" class="alert alert-success alert-dismissible fade show" role="alert" th:text="${mensaje}">Mensaje</div>
                <div class="text-center mb-4">
                    <h1 class="h3 fw-semibold mb-1">Resultados del Examen</h1>
                </div>
                <div class="mt-4">
                    <div class="table-responsive">
                        <table class="table app-table w-100">
                            <thead>
                                <tr>
                                    <th>Fecha de realización</th>
                                    <th>Tema</th>
                                    <th>Hora de inicio</th>
                                    <th>Tiempo del examen</th>
                                    <th>Preguntas</th>
                                    <th>Aciertos</th>
                                    <th>Resultado</th>
                                    <th class="text-end">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="examen : ${examenes}">
                                    <td th:text="${examen.fechaHoraInicio != null ? #temporals.format(examen.fechaHoraInicio, 'dd/MM/yyyy') : '—'}">—</td>
                                    <td th:text="${examen.tipoExamen != null ? examen.tipoExamen.descripcion : '—'}">—</td>
                                    <td th:text="${examen.fechaHoraInicio != null ? #temporals.format(examen.fechaHoraInicio, 'HH:mm') : '—'}">—</td>
                                    <td th:text="${examen.minutosTranscurrido != null ? examen.minutosTranscurrido + ' min' : '—'}">—</td>
                                    <td th:text="${examen.numeroPreguntas != null ? examen.numeroPreguntas : '—'}">—</td>
                                    <td th:text="${aciertosPorExamen != null ? aciertosPorExamen[examen.id] : 0}">0</td>
                                    <td th:with="aciertos=${aciertosPorExamen != null && examen.id != null ? aciertosPorExamen[examen.id] : 0}, total=${examen.numeroPreguntas != null ? examen.numeroPreguntas : 0}, aprobado=${total > 0 and (aciertos != null ? aciertos : 0) * 10 >= total * 7}">
                                        <span th:if="${aprobado}" class="badge bg-success">Aprobado</span>
                                        <span th:unless="${aprobado}" class="badge bg-danger">No aprobado</span>
                                    </td>
                                    <td class="text-end">
                                        <a th:if="${examen.id != null}" th:href="@{/examen/resultados/{id}(id=${examen.id})}" class="btn btn-sm btn-outline-primary me-1">Ver resultados</a>
                                        <form th:if="${examen.id != null}" th:action="@{/examen/borrar/{id}(id=${examen.id})}" method="post" class="d-inline" onsubmit="return confirm('¿Borrar este examen?');">
                                            <button type="submit" class="btn btn-sm btn-outline-danger" title="Borrar examen">Borrar</button>
                                        </form>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
